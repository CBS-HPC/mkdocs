
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../../images/CBS_logo2.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>Reference - HPC & Data Science Support</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://example.com" title="HPC &amp; Data Science Support" class="md-header__button md-logo" aria-label="HPC & Data Science Support" data-md-component="logo">
      
  <img src="../../../images/CBS_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HPC & Data Science Support
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/CBS-HPC/CBS-HPC.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CBS-HPC/CBS-HPC.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../news/" class="md-tabs__link">
      News
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../events/" class="md-tabs__link">
      Teaching Events
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../hpc/" class="md-tabs__link">
      HPC Facilites
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../getresources/" class="md-tabs__link">
      Get Resources
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../tut_docs/" class="md-tabs__link">
      Tutorials & Documentation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../contact/" class="md-tabs__link">
      Contact
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../LICENSE/" class="md-tabs__link">
      License
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://example.com" title="HPC &amp; Data Science Support" class="md-nav__button md-logo" aria-label="HPC & Data Science Support" data-md-component="logo">
      
  <img src="../../../images/CBS_logo.png" alt="logo">

    </a>
    HPC & Data Science Support
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CBS-HPC/CBS-HPC.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CBS-HPC/CBS-HPC.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../news/" class="md-nav__link">
        News
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../events/" class="md-nav__link">
        Teaching Events
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../hpc/" class="md-nav__link">
        HPC Facilites
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../getresources/" class="md-nav__link">
        Get Resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../tut_docs/" class="md-nav__link">
        Tutorials & Documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../LICENSE/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#moodys_datahub.tools" class="md-nav__link">
    tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp" class="md-nav__link">
    Sftp
  </a>
  
    <nav class="md-nav" aria-label="Sftp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.connect" class="md-nav__link">
    connect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.copy_obj" class="md-nav__link">
    copy_obj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.get_column_names" class="md-nav__link">
    get_column_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.process_all" class="md-nav__link">
    process_all
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.process_one" class="md-nav__link">
    process_one
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.search_country_codes" class="md-nav__link">
    search_country_codes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.search_dictionary" class="md-nav__link">
    search_dictionary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.select_columns" class="md-nav__link">
    select_columns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.select_data" class="md-nav__link">
    select_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.table_dates" class="md-nav__link">
    table_dates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moodys_datahub.tools.Sftp.tables_available" class="md-nav__link">
    tables_available
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moodys_datahub.utils" class="md-nav__link">
    utils
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moodys_datahub.utils.fuzzy_match" class="md-nav__link">
    fuzzy_match
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moodys_datahub.utils.year_distribution" class="md-nav__link">
    year_distribution
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="moodys_datahub.tools"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="moodys_datahub.tools.Sftp" class="doc doc-heading">
            <code>Sftp</code>


<a href="#moodys_datahub.tools.Sftp" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Sftp</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s-f2112b8b980e44f9a.server.transfer.eu-west-1.amazonaws.com&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;D2vdz8elTWKyuOcC2kMSnw&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span> <span class="n">privatekey</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor Method</span>

<span class="sd">         ### Sftp Class Object Variables        </span>
<span class="sd">        - `connection`: None or pysftp.Connection object. Represents the current SFTP connection.</span>

<span class="sd">        - `hostname`: str. Hostname of the SFTP server (Default connects to CBS SFTP server).</span>
<span class="sd">        - `username`: str. Username for authentication (Default connects to CBS SFTP server).</span>
<span class="sd">        - `privatekey`: str or None. Path to the private key file for authentication (Valid private key is needed to access SFTP server)</span>
<span class="sd">        - `port`: int. Port number for the SFTP connection (default is 22).</span>

<span class="sd">        - `output_format`: list of str. List of supported output file formats (e.g., [&#39;.csv&#39;, &#39;.parquet&#39;]).</span>
<span class="sd">        - `file_size_mb`: int. Maximum file size in MB for before splitting output files..</span>
<span class="sd">        - `delete_files`: bool. Flag indicating whether to delete processed files.</span>
<span class="sd">        - `concat_files`: bool. Flag indicating whether to concatenate processed files.</span>
<span class="sd">        - `select_cols`: list or None. List of columns to select during file operations.</span>
<span class="sd">        - `query`: str, fnc or None. Query string or function for filtering data.</span>
<span class="sd">        - `query_args`: list or None. list of arguments for the query string or function.</span>
<span class="sd">        - `dfs`: None or DataFrame. Stores concatenated DataFrames if concatenation is enabled.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Set connection object to None (initial value)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">hostname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">privatekey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span> <span class="o">=</span> <span class="n">pysftp</span><span class="o">.</span><span class="n">CnOpts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span><span class="o">.</span><span class="n">hostkeys</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;.csv&#39;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;fork&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span> <span class="o">=</span> <span class="s1">&#39;fork&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span> <span class="o">=</span> <span class="s1">&#39;threading&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">4096</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tables_available</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># pool method</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pool_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span>

    <span class="nd">@pool_method</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pool_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the worker pool method for concurrent operations.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `method` (str): Worker pool method (`&#39;fork&#39;`, `&#39;threading&#39;`, `&#39;spawn&#39;`).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Current worker pool method (`&#39;fork&#39;`, `&#39;threading&#39;`, `&#39;spawn&#39;`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fork&#39;</span><span class="p">,</span><span class="s1">&#39;theading&#39;</span><span class="p">,</span><span class="s1">&#39;spawn&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;invalid worker pool method&#39;</span><span class="p">)</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;fork&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;fork&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">==</span><span class="s1">&#39;fork&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fork() processes are not supported by OS&#39;</span><span class="p">)</span>
            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;spawn&#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&quot; is chosen as worker pool method&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span> <span class="o">==</span> <span class="n">method</span>

    <span class="c1"># Local path and files</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>

    <span class="nd">@local_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">local_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the local path for operations.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `path` (str): Local path to set or retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Current local path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span>  <span class="o">=</span> <span class="kc">None</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">,</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span>

    <span class="nd">@local_files</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">local_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_files</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span>

    <span class="nd">@remote_path</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">remote_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the remote path for operations.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `path` (str): Remote path to set or retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Current remote path.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span>  <span class="o">=</span> <span class="kc">None</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>   <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>   <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s2">&quot;remote&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Base Directory` == &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Export` == &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>                 
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="p">:</span>    
                        <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="n">df</span> 

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s2">&quot;remote&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remote_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span>

    <span class="nd">@remote_files</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">remote_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_files</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_data_product</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span>

    <span class="nd">@set_data_product</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_data_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set or retrieve the current data product.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `product` (str): Data product name to set or retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Current data product.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remote_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="p">:</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product`.str.contains(&#39;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>  
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">matches</span>   <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple data products partionally match &#39;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">&#39; : </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">. Please set right data product&quot;</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One data product partionally match &#39;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">&#39; : </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">. Please set right data product&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Export&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matches</span>   <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Export&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple version of &#39;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">&#39; are detected: </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> with export paths (&#39;Export&#39;) </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Export&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> .Please Set the &#39;.remote_path&#39; property with the correct &#39;Export&#39; Path&quot;</span><span class="p">)</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="n">df</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="n">product</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span>

    <span class="nd">@set_table</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set or retrieve the current table.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `table` (str): Table name to set or retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Current table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remote_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39; &amp;  `Data Product` == &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">matches</span>   <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple tables partionally match &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39; : </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">. Please set right table&quot;</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>    
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="n">matches</span>   <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple tables match &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39; : </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">. Please set Data Product using the &#39;.set_data_product&#39; property&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Export&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">matches</span>   <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">,</span><span class="s1">&#39;Export&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multiple version of &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39; are detected: </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> with export paths (&#39;Base Directory&#39;) </span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="s1">&#39;Base Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2"> .Please Set the &#39;.remote_path&#39; property with the correct &#39;Base Directory&#39; Path&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="n">table</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remote_path</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Base Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bvd_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span>

    <span class="nd">@bvd_list</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bvd_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bvd_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">load_bvd_list</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">df_bvd</span> <span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="c1"># Get the file extension</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Load the file based on the extension</span>
            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;xls&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">]:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;txt&#39;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file extension: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Process each column</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># Convert the column to a list of strings</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bvd_list</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

                    <span class="c1"># Pass through the first function</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">)</span>

                    <span class="c1"># Pass through the second function</span>
                    <span class="n">bvd_list</span><span class="p">,</span> <span class="n">search_type</span><span class="p">,</span> <span class="n">non_matching_items</span> <span class="o">=</span> <span class="n">check_bvd_format</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span> <span class="n">df_bvd</span><span class="p">)</span>

                    <span class="c1"># If successful, return the result</span>
                    <span class="k">if</span> <span class="n">search_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">bvd_list</span><span class="p">,</span> <span class="n">search_type</span><span class="p">,</span> <span class="n">non_matching_items</span>

            <span class="k">return</span>  <span class="n">bvd_list</span><span class="p">,</span> <span class="n">search_type</span><span class="p">,</span> <span class="n">non_matching_items</span>  

        <span class="k">def</span> <span class="nf">check_bvd_format</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="n">bvd_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">))</span>
            <span class="c1"># Check against df[&#39;Code&#39;].values</span>
            <span class="n">df_code_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">df_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bvd_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_code_values</span><span class="p">]</span>
            <span class="n">df_match_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_matches</span><span class="p">)</span>

            <span class="c1"># Check against the regex pattern</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[A-Za-z]+[*]?[A-Za-z]*\d*[-\dA-Za-z]*$&#39;</span><span class="p">)</span>
            <span class="n">regex_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bvd_list</span> <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
            <span class="n">regex_match_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">regex_matches</span><span class="p">)</span>

            <span class="c1"># Determine which check has more matches</span>
            <span class="k">if</span> <span class="n">df_match_count</span> <span class="o">&gt;=</span> <span class="n">regex_match_count</span><span class="p">:</span>
                <span class="n">non_matching_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bvd_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_code_values</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">df_matches</span><span class="p">,</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">df_match_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">non_matching_items</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">non_matching_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bvd_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
                <span class="k">return</span> <span class="n">regex_matches</span><span class="p">,</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">regex_match_count</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">non_matching_items</span>

        <span class="k">if</span> <span class="n">bvd_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">search_country_codes</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">search_word</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">):</span>
                <span class="n">bvd_list</span><span class="p">,</span> <span class="n">search_type</span><span class="p">,</span><span class="n">non_matching_items</span> <span class="o">=</span> <span class="n">load_bvd_list</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="nb">list</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">str</span><span class="p">)):</span>
                <span class="n">search_word</span> <span class="o">=</span>  <span class="n">bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">bvd_list</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">bvd_list</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">)</span>
            <span class="n">bvd_list</span><span class="p">,</span> <span class="n">search_type</span><span class="p">,</span><span class="n">non_matching_items</span> <span class="o">=</span> <span class="n">check_bvd_format</span><span class="p">(</span><span class="n">bvd_list</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">search_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following elements does not seem to match bvd format:</span><span class="si">{</span><span class="n">non_matching_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bvd_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bvd_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">search_word</span> <span class="o">=</span> <span class="n">search_word</span><span class="p">,</span><span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;Column&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Definition&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">bvd_col</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No &#39;bvd&#39; columns were found for this table&quot;</span><span class="p">)</span>

            <span class="n">bvd_col</span> <span class="o">=</span> <span class="n">bvd_col</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">bvd_list</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bvd_col</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">search_word</span> <span class="ow">in</span> <span class="n">bvd_col</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_word</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_select_list</span><span class="p">(</span><span class="s1">&#39;_SelectMultiple&#39;</span><span class="p">,</span><span class="n">bvd_col</span><span class="p">,</span><span class="s1">&#39;Columns:&#39;</span><span class="p">,</span><span class="s1">&#39;Select &quot;bvd&quot; Columns to filtrate&#39;</span><span class="p">,</span><span class="n">_select_bvd</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">,</span> <span class="n">search_type</span><span class="p">])</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">bvd_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">_construct_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">search_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span>

    <span class="nd">@time_period</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">time_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">years</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">check_year</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
            <span class="c1"># Get the current year</span>
            <span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>

            <span class="c1"># Check if the list has exactly two elements</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The list must contain at least a start and end year e.g [1998,2005]. It can also contain a column name as a third element [1998,2005,&#39;closing_date&#39;]&quot;</span><span class="p">)</span>

            <span class="c1"># Initialize start and end year with default values</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1900</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">current_year</span>

            <span class="c1"># Check if years are integers</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_year</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both start year and end year must be integers&quot;</span><span class="p">)</span>

            <span class="c1"># Check if years are within a valid range</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="mi">1900</span> <span class="ow">or</span> <span class="n">start_year</span> <span class="o">&gt;</span> <span class="n">current_year</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start year must be between 1900 and </span><span class="si">{</span><span class="n">current_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&lt;</span> <span class="mi">1900</span> <span class="ow">or</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="n">current_year</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End year must be between 1900  and </span><span class="si">{</span><span class="n">current_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Check if start year is less than or equal to end year</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&gt;</span> <span class="n">end_year</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Start year must be less than or equal to end year&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="n">years</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> 

        <span class="k">if</span> <span class="n">years</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span> <span class="n">check_year</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

            <span class="n">date_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_dates</span><span class="p">(</span><span class="n">data_product</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">date_col</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No data columns were found for this table&quot;</span><span class="p">)</span>

            <span class="n">date_col</span> <span class="o">=</span> <span class="n">date_col</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">date_col</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> was not found as date related column: </span><span class="si">{</span><span class="n">date_col</span><span class="si">}</span><span class="s2">. Set ._time_period[2] with the correct one&quot;</span><span class="p">)</span> 

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">date_col</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">_select_list</span><span class="p">(</span><span class="s1">&#39;_SelectList&#39;</span><span class="p">,</span><span class="n">date_col</span><span class="p">,</span><span class="s1">&#39;Columns:&#39;</span><span class="p">,</span><span class="s1">&#39;Select &quot;date&quot; Column to filtrate&#39;</span><span class="p">,</span><span class="n">_select_date</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">])</span>
                <span class="k">return</span>          

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span> <span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">select_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span>

    <span class="nd">@select_cols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">select_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">select_cols</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">select_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

            <span class="n">select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="n">select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="n">table_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">data_product</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">table_cols</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No columns were found for this table&quot;</span><span class="p">)</span>

            <span class="n">table_cols</span> <span class="o">=</span> <span class="n">table_cols</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">element</span> <span class="ow">in</span> <span class="n">table_cols</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">select_cols</span><span class="p">):</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">table_cols</span> <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">select_cols</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following selected columns cannot be found in the table columns&quot;</span><span class="p">,</span> <span class="n">not_found</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">select_cols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Establish an SFTP connection.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - SFTP connection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sftp</span> <span class="o">=</span> <span class="n">pysftp</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="p">,</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="p">,</span><span class="n">private_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">,</span> <span class="n">cnopts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sftp</span>

    <span class="k">def</span> <span class="nf">select_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously select and set the data product and table using interactive widgets.</span>

<span class="sd">        This method initializes an instance of `_SelectData` with `_tables_backup`, displays interactive widgets</span>
<span class="sd">        to allow the user to select a data product and table, and sets these selections to `self.set_data_product`</span>
<span class="sd">        and `self.set_table`, respectively. It also prints the selected data product and table.</span>

<span class="sd">        The method ensures that `_tables_available` or `_tables_backup` is populated by calling `tables_available()`</span>
<span class="sd">        if they are not already set.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - This method uses `asyncio.ensure_future` to run the asynchronous function `f` which handles the widget interaction.</span>

<span class="sd">        Example:</span>
<span class="sd">            self.select_data()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">Select_obj</span> <span class="o">=</span> <span class="n">_SelectData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">,</span><span class="s1">&#39;Select Data Product and Table&#39;</span><span class="p">)</span>
            <span class="n">selected_product</span><span class="p">,</span> <span class="n">selected_table</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Select_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">,</span><span class="s1">&#39;Base Directory&#39;</span><span class="p">,</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">selected_product</span><span class="si">}</span><span class="s2">&#39; &amp; `Table` == &#39;</span><span class="si">{</span><span class="n">selected_table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">product</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Multiple data products match &#39;</span><span class="si">{</span><span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. Please set right data product:&quot;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="n">selected_table</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="n">selected_product</span>
                <span class="n">_select_list</span><span class="p">(</span><span class="s1">&#39;_SelectList&#39;</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="n">_select_product</span><span class="p">,[</span><span class="n">df</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="o">=</span> <span class="n">selected_product</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="o">=</span> <span class="n">selected_table</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="si">}</span><span class="s2"> was set as Data Product&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">set_table</span><span class="si">}</span><span class="s2"> was set as Table&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">None</span> 

        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">define_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;delete_files&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span><span class="p">,</span>
            <span class="s1">&#39;concat_files&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span><span class="p">,</span>
            <span class="s1">&#39;output_format&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">,</span>
            <span class="s1">&#39;file_size_mb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="p">}</span>

            <span class="n">Options_obj</span> <span class="o">=</span> <span class="n">_SelectOptions</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="n">config</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Options_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">config</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;delete_files&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;concat_files&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;output_format&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;file_size_mb&#39;</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following options were selected:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Delete Files: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concatenate Files: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output File Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="w"> </span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">select_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously select and set columns for a specified data product and table using interactive widgets.</span>

<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Checks if the data product and table are set. If not, it calls `select_data()` to set them.</span>
<span class="sd">        2. Searches the dictionary for columns corresponding to the set data product and table.</span>
<span class="sd">        3. Displays an interactive widget for the user to select columns based on their names and definitions.</span>
<span class="sd">        4. Sets the selected columns to `self._select_cols` and prints the selected columns.</span>

<span class="sd">        If no columns are found for the specified table, a `ValueError` is raised.</span>

<span class="sd">        Args:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - This method uses `asyncio.ensure_future` to run the asynchronous function `f` which handles the widget interaction.</span>
<span class="sd">        - The function `f` combines column names and definitions for display, maps selected items to their indices,</span>
<span class="sd">        and then extracts the selected columns based on these indices.</span>

<span class="sd">        Raises:</span>
<span class="sd">        - `ValueError`: If no columns are found for the specified table.</span>

<span class="sd">        Example:</span>
<span class="sd">            self.select_columns()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>

            <span class="n">combined</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">  -----  </span><span class="si">{</span><span class="n">defn</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">defn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">)]</span>

            <span class="n">Select_obj</span> <span class="o">=</span> <span class="n">_SelectMultiple</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span><span class="s1">&#39;Columns:&#39;</span><span class="p">,</span><span class="s2">&quot;Select Table Columns&quot;</span><span class="p">)</span>
            <span class="n">selected_list</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Select_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selected_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># Create a dictionary to map selected strings to their indices in the combined list</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="n">combined</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">}</span>

                <span class="c1"># Extract selected columns based on indices</span>
                <span class="n">selected_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">selected_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following columns have been selected: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

        <span class="n">table_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">data_product</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">table_cols</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No columns were found for this table&quot;</span><span class="p">)</span>

        <span class="n">column</span> <span class="o">=</span> <span class="n">table_cols</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">definition</span> <span class="o">=</span> <span class="n">table_cols</span><span class="p">[</span><span class="s1">&#39;Definition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">))</span> 

    <span class="k">def</span> <span class="nf">copy_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a deep copy of the current Sftp instance with optional updates.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Deep copy of the current Sftp instance with optional updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_obj</span><span class="o">=</span> <span class="n">Sftp</span><span class="p">(</span><span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span> <span class="n">privatekey</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">)</span> 

        <span class="c1">#new_obj = copy.deepcopy(self)</span>

        <span class="n">new_obj</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>
        <span class="c1">#new_obj.bvd_list = None</span>
        <span class="c1">#new_obj.time_period = None</span>
        <span class="c1">#new_obj.select_cols = None</span>

        <span class="k">return</span> <span class="n">new_obj</span>

    <span class="k">def</span> <span class="nf">table_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve and save the available date columns for a specified data product and table.</span>

<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Ensures that the available tables and table dates are loaded.</span>
<span class="sd">        2. Filters the dates data by the specified data product and table, if provided.</span>
<span class="sd">        3. Optionally saves the filtered results to a specified format.</span>

<span class="sd">        Args:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `save_to` (str, optional): Format to save results. If False, results are not saved (default is False).</span>
<span class="sd">        - `data_product` (str, optional): Specific data product to filter results by. If None, defaults to `self.set_data_product`.</span>
<span class="sd">        - `table` (str, optional): Specific table to filter results by. If None, defaults to `self.set_table`.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - pandas.DataFrame: A DataFrame containing the filtered dates for the specified data product and table. If no results are found, an empty DataFrame is returned.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - If `data_product` is provided and does not match any records, a message is printed and an empty DataFrame is returned.</span>
<span class="sd">        - If `table` is provided and does not match any records, it attempts to perform a case-insensitive partial match search.</span>
<span class="sd">        - If `save_to` is specified, the query results are saved in the format specified.</span>

<span class="sd">        Example:</span>
<span class="sd">            df = self.table_dates(save_to=&#39;csv&#39;, data_product=&#39;Product1&#39;, table=&#39;TableA&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>    

        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span>

            <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="o">=</span> <span class="n">_table_dates</span><span class="p">()</span>        
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())]</span>

        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_product</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_product</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df_product</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_product</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">df_table</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_table</span>

        <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;date_cols_search&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>    

    <span class="c1"># Under development</span>
    <span class="k">def</span> <span class="nf">_search_dictionary_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">search_word</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Table&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Column&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Definition&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="n">letters_only</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exact_match</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for a term in a column/variable dictionary and save results to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `save_to` (str, optional): Format to save results. If False, results are not saved (default is False).</span>
<span class="sd">        - `search_word` (str or list of str, optional): Search term(s). If None, no term is searched.</span>
<span class="sd">        - `search_cols` (dict, optional): Dictionary indicating which columns to search. Columns are &#39;Data Product&#39;, &#39;Table&#39;, &#39;Column&#39;, and &#39;Definition&#39; with default value as True for each.</span>
<span class="sd">        - `letters_only` (bool, optional): If True, search only for alphabetic characters in the search term (default is False).</span>
<span class="sd">        - `exact_match` (bool, optional): If True, search for an exact match of the search term. Otherwise, search for partial matches (default is False).</span>
<span class="sd">        - `data_product` (str, optional): Specific data product to filter results by. If None, no filtering by data product (default is None).</span>
<span class="sd">        - `table` (str, optional): Specific table to filter results by. If None, no filtering by table (default is None).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - pandas.DataFrame: A DataFrame containing the search results. If no results are found, an empty DataFrame is returned.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - If `data_product` is provided and does not match any records, a message is printed and an empty DataFrame is returned.</span>
<span class="sd">        - If `table` is provided and does not match any records, it attempts to perform a case-insensitive partial match search.</span>
<span class="sd">        - If `search_word` is provided and no matches are found, a message is printed indicating no results were found.</span>
<span class="sd">        - If `letters_only` is True, the search term is processed to include only alphabetic characters before searching.</span>
<span class="sd">        - If `save_to` is specified, the query results are saved in the format specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="o">=</span> <span class="n">_table_dictionary</span><span class="p">()</span>        

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())]</span>

        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_product</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_product</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df_product</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_product</span>
            <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
                <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False, regex=False)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">df_table</span>
            <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_table</span> 

        <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
                <span class="n">df_backup</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_letters_only_regex</span><span class="p">)</span>


            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">search_word</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">search_word</span> <span class="o">=</span> <span class="p">[</span><span class="n">search_word</span><span class="p">]</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">search_word</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
                    <span class="n">word</span> <span class="o">=</span> <span class="n">_letters_only_regex</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exact_match</span><span class="p">:</span>
                    <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">` == &#39;{{word}}&#39;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">`.str.contains(&#39;{{word}}&#39;, case=False, na=False, regex=False)&quot;</span>

                <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
                <span class="n">final_string</span> <span class="o">=</span> <span class="n">search_conditions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>

                <span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">final_string</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
                    <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No such &#39;</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">&#39; was detected across columns: &quot;</span> <span class="o">+</span> <span class="n">search_conditions</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
                      <span class="n">result_df</span> <span class="o">=</span> <span class="n">df_backup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">result_df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>  
                    <span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;search_word&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">word</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1">#if letters_only:</span>
            <span class="c1">#    df = df_backup.loc[df.index]</span>

            <span class="k">if</span> <span class="n">save_to</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following query was executed for each word in search_word: </span><span class="si">{</span><span class="n">search_word</span><span class="si">}</span><span class="s2"> : &quot;</span><span class="p">)</span>

        <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;dict_search&#39;</span><span class="p">,</span> <span class="n">save_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">search_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">search_word</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Column&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Definition&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="n">letters_only</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">extact_match</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for a term in a column/variable dictionary and save results to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `save_to` (str, optional): Format to save results. If False, results are not saved (default is False).</span>
<span class="sd">        - `search_word` (str, optional): Search term. If None, no term is searched.</span>
<span class="sd">        - `search_cols` (dict, optional): Dictionary indicating which columns to search. Columns are &#39;Data Product&#39;, &#39;Table&#39;, &#39;Column&#39;, and &#39;Definition&#39; with default value as True for each.</span>
<span class="sd">        - `letters_only` (bool, optional): If True, search only for alphabetic characters in the search term (default is False).</span>
<span class="sd">        - `exact_match` (bool, optional): If True, search for an exact match of the search term. Otherwise, search for partial matches (default is False).</span>
<span class="sd">        - `data_product` (str, optional): Specific data product to filter results by. If None, no filtering by data product (default is None).</span>
<span class="sd">        - `table` (str, optional): Specific table to filter results by. If None, no filtering by table (default is None).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - pandas.DataFrame: A DataFrame containing the search results. If no results are found, an empty DataFrame is returned.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - If `data_product` is provided and does not match any records, a message is printed and an empty DataFrame is returned.</span>
<span class="sd">        - If `table` is provided and does not match any records, it attempts to perform a case-insensitive partial match search.</span>
<span class="sd">        - If `search_word` is provided and no matches are found, a message is printed indicating no results were found.</span>
<span class="sd">        - If `letters_only` is True, the search term is processed to include only alphabetic characters before searching.</span>
<span class="sd">        - If `save_to` is specified, the query results are saved in the format specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span>

            <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="o">=</span> <span class="n">_table_dictionary</span><span class="p">()</span>        
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())]</span>

        <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_product</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_product</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df_product</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_product</span>
            <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
                <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">df_table</span>
            <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_table</span> 

        <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
                <span class="n">df_backup</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">search_word</span> <span class="o">=</span> <span class="n">_letters_only_regex</span><span class="p">(</span><span class="n">search_word</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_letters_only_regex</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">extact_match</span><span class="p">:</span>
                <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">` ==  &#39;{{search_word}}&#39;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">`.str.contains(&#39;{{search_word}}&#39;, case=False, na=False,regex=False)&quot;</span>

            <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
            <span class="n">final_string</span> <span class="o">=</span> <span class="n">search_conditions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_word</span><span class="o">=</span><span class="n">search_word</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">final_string</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
                <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such &#39;search word&#39; was detected across columns: &quot;</span> <span class="o">+</span> <span class="n">search_conditions</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df</span>

            <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df_backup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">save_to</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folloiwng query was executed:&quot;</span> <span class="o">+</span> <span class="n">final_string</span><span class="p">)</span>

        <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;dict_search&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>    

    <span class="k">def</span> <span class="nf">orbis_to_moodys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_load_orbis_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Results&#39;</span><span class="p">)</span>

            <span class="c1"># Get the headings (column names) from the DataFrame</span>
            <span class="n">headings</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Process headings to keep only the first line if they contain multiple lines</span>
            <span class="n">processed_headings</span> <span class="o">=</span> <span class="p">[</span><span class="n">heading</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">heading</span> <span class="ow">in</span> <span class="n">headings</span><span class="p">]</span>

            <span class="c1"># Keep only unique headings</span>
            <span class="n">unique_headings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">processed_headings</span><span class="p">))</span> 
            <span class="n">unique_headings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">unique_headings</span>

        <span class="k">def</span> <span class="nf">sort_by</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="c1"># Sort by &#39;Data Product&#39;</span>
            <span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Data Product&#39;</span><span class="p">)</span>

            <span class="c1"># Count unique headings for each &#39;Data Product&#39;</span>
            <span class="n">grouped</span> <span class="o">=</span> <span class="n">df_sorted</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Data Product&#39;</span><span class="p">)[</span><span class="s1">&#39;heading&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">grouped</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span> <span class="s1">&#39;unique_headings&#39;</span><span class="p">]</span>

            <span class="c1"># Sort &#39;Data Product&#39; based on the number of unique headings in descending order</span>
            <span class="n">sorted_products</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;unique_headings&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span>

            <span class="c1"># Reorder the original DataFrame based on the sorted &#39;Data Product&#39;</span>
            <span class="n">df_reordered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">df_sorted</span><span class="p">[</span><span class="n">df_sorted</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">product</span><span class="p">]</span> <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">sorted_products</span><span class="p">],</span>
                <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df_reordered</span>

        <span class="n">headings</span> <span class="o">=</span> <span class="n">_load_orbis_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">headings_processed</span> <span class="o">=</span> <span class="p">[</span><span class="n">_letters_only_regex</span><span class="p">(</span><span class="n">heading</span><span class="p">)</span> <span class="k">for</span> <span class="n">heading</span> <span class="ow">in</span> <span class="n">headings</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">_table_dictionary</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;letters_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_letters_only_regex</span><span class="p">)</span>

        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">not_found</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">heading</span><span class="p">,</span> <span class="n">heading_processed</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">headings</span><span class="p">,</span><span class="n">headings_processed</span><span class="p">):</span>
            <span class="n">df_sel</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`letters_only` == &#39;</span><span class="si">{</span><span class="n">heading_processed</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df_sel</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">heading</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_sel</span> <span class="o">=</span> <span class="n">df_sel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Avoid SettingWithCopyWarning</span>
                <span class="n">df_sel</span><span class="p">[</span><span class="s1">&#39;heading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">heading</span> 
                <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_sel</span><span class="p">)</span>

        <span class="c1"># Concatenate all found DataFrames if needed</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">sort_by</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">found</span><span class="p">,</span> <span class="n">not_found</span>

    <span class="k">def</span> <span class="nf">tables_available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">reset</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve available SFTP data products and tables and save them to a file.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `save_to` (str, optional): Format to save results (default is CSV).</span>
<span class="sd">        - `reset` (bool, optional): Reset flag to force refreshing data products and tables.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Pandas DataFrame with the available SFTP data products and tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="p">,</span><span class="n">to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_overview</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">==</span> <span class="s2">&quot;s-f2112b8b980e44f9a.server.transfer.eu-west-1.amazonaws.com&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------  DELETING OLD EXPORTS FROM SFTP&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_exports</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Specify unknown data product exports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_specify_data_products</span><span class="p">()</span>

        <span class="n">_save_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="p">,</span><span class="s1">&#39;tables_available&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">search_country_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">search_word</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Country&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Code&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}):</span>        
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for country codes matching a search term.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `search_word` (str, optional): Term to search for country codes.</span>
<span class="sd">        - `search_cols` (dict, optional): Dictionary indicating columns to search (default is {&#39;Country&#39;:True,&#39;Code&#39;:True}).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Pandas Dataframe of country codes matching the search term</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">_country_codes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">`.str.contains(&#39;{{search_word}}&#39;, case=False, na=False,regex=False)&quot;</span>
            <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
            <span class="n">final_string</span> <span class="o">=</span> <span class="n">search_conditions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_word</span><span class="o">=</span><span class="n">search_word</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">final_string</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
                <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such &#39;search word&#39; was detected across columns: &quot;</span> <span class="o">+</span> <span class="n">search_conditions</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folloiwng query was executed:&quot;</span> <span class="o">+</span> <span class="n">final_string</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>    

    <span class="k">def</span> <span class="nf">process_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">n_rows</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a sample of data from a table and save it to a file.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `files` (list, optional): List of files to process. Defaults to `self.remote_files`.</span>
<span class="sd">        - `save_to` (str, optional): Format to save sample data (default is CSV).</span>
<span class="sd">        - `n_rows` (int, optional): Number of rows to retrieve (default is 1000).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - Pandas Dateframe with output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>    

        <span class="n">df</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_all</span><span class="p">(</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">df</span>  <span class="o">=</span> <span class="n">_load_table</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
            <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;process_one&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results have been saved to &#39;</span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>  
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No rows were retained&quot;</span><span class="p">)</span>  
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">process_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">destination</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">date_query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bvd_query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query_args</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">pool_method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read and process files into a DataFrame with optional filtering and parallel processing.</span>

<span class="sd">        This method reads multiple files into Pandas DataFrames, optionally selecting specific columns and</span>
<span class="sd">        applying filters, either sequentially or in parallel.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `files` (list, optional): List of files to process. Defaults to `self.remote_files`.</span>
<span class="sd">        - `destination` (str, optional): Destination path for processed files.</span>
<span class="sd">        - `num_workers` (int, optional): Number of workers for parallel processing. Default is -1 (auto-determined).</span>
<span class="sd">        - `select_cols` (list, optional): Columns to select from files. Default is `self._select_cols`.</span>
<span class="sd">        - `date_query`: (optional): Date query for filtering data. Default is `self.time_period`.</span>
<span class="sd">        - `bvd_query`: (optional): BVD query for filtering data. Default is `self._bvd_list[2]`.</span>
<span class="sd">        - `query` (str, optional): Query for additional filtering of data.</span>
<span class="sd">        - `query_args` (list, optional): Arguments for the query.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - `dfs`: List of Pandas DataFrames with selected columns and filtered data.</span>
<span class="sd">        - `file_names`: List of file names processed.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - If `select_cols` is provided, it is validated against expected formats.</span>
<span class="sd">        - Uses parallel processing if `num_workers` is greater than 1.</span>
<span class="sd">        - Handles file concatenation and deletion based on instance attributes (`concat_files`, `delete_files`).</span>
<span class="sd">        - Prints current working directory if `self.delete_files` is `True`.</span>

<span class="sd">        Raises:</span>
<span class="sd">        - `ValueError`: If validation of arguments (`files`, `destination`, `flag`) fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">files</span> <span class="o">=</span> <span class="n">files</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span>
        <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span>
        <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span>
        <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span>
        <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span>

        <span class="c1"># To handle executing when download_all() have not finished!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span> 
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">files_not_ready</span> <span class="o">=</span>  <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)</span> 
            <span class="k">while</span> <span class="n">files_not_ready</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="n">files_not_ready</span> <span class="o">=</span>  <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files have not finished downloading within the timeout period of </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span><span class="kc">True</span> 

        <span class="k">if</span> <span class="n">select_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="n">select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span>  <span class="nb">any</span><span class="p">([</span><span class="n">select_cols</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="nb">all</span><span class="p">(</span><span class="n">date_query</span><span class="p">),</span><span class="n">bvd_query</span><span class="p">])</span> 
            <span class="n">files</span><span class="p">,</span> <span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">destination</span><span class="p">,</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">num_workers</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">num_workers</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">num_workers</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span><span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Read multithreaded</span>
        <span class="k">if</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">batch_processing</span><span class="p">():</span>
                <span class="k">def</span> <span class="nf">batch_list</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;Splits the input list into batches of a given size.&quot;&quot;&quot;</span>
                    <span class="n">batches</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
                        <span class="n">batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_list</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">batches</span>

                <span class="n">batches</span> <span class="o">=</span> <span class="n">batch_list</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">num_workers</span><span class="p">)</span>

                <span class="n">lists</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in Parallel&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batches</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing Batch </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------ First file: &#39;</span><span class="si">{</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>  
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------ Last file : &#39;</span><span class="si">{</span><span class="n">batch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>               
                    <span class="n">params_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">file</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">,</span> <span class="n">date_query</span><span class="p">,</span> <span class="n">bvd_query</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
                    <span class="n">list_batch</span> <span class="o">=</span> <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_parallel</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">params_list</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span><span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span><span class="n">pool_method</span><span class="o">=</span><span class="n">pool_method</span> <span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Processing&#39;</span><span class="p">)</span>
                    <span class="n">lists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">list_batch</span><span class="p">)</span>


                <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>
                <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span> <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

                <span class="n">dfs</span> <span class="o">=</span>  <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>
                <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span> <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

                <span class="n">flags</span> <span class="o">=</span>  <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span>

            <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">batch_processing</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># Read Sequential</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in sequence&#39;</span><span class="p">)</span>
            <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_sequential</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">,</span> <span class="n">date_query</span><span class="p">,</span> <span class="n">bvd_query</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_args</span><span class="p">,</span><span class="n">num_workers</span><span class="p">)</span>

        <span class="n">flag</span> <span class="o">=</span>  <span class="nb">all</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> 

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>

            <span class="c1"># Concatenate and save</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span> <span class="o">=</span> <span class="n">_save_chunks</span><span class="p">(</span><span class="n">dfs</span><span class="o">=</span><span class="n">dfs</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span><span class="n">output_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">,</span><span class="n">file_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span>

    <span class="k">def</span> <span class="nf">download_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num_workers</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;fork&#39;</span><span class="p">):</span>
            <span class="n">pool_method</span> <span class="o">=</span> <span class="s1">&#39;fork&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Function only works on Unix systems right now&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">num_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_workers</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span><span class="ow">and</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">num_workers</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading all files&quot;</span><span class="p">)</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_all</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;num_workers&#39;</span><span class="p">:</span> <span class="n">num_workers</span><span class="p">,</span> <span class="s1">&#39;pool_method&#39;</span><span class="p">:</span> <span class="n">pool_method</span><span class="p">})</span>
        <span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">False</span> 

    <span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve column names from a DataFrame or dictionary and save them to a file.</span>

<span class="sd">        Input Variables:</span>
<span class="sd">        - `self`: Implicit reference to the instance.</span>
<span class="sd">        - `save_to` (str, optional): Format to save results (default is CSV).</span>
<span class="sd">        - `files` (list, optional): List of files to retrieve column names from.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - List of column names or None if no valid source is provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">from_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">column_names</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No files were added&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span>   

            <span class="k">try</span><span class="p">:</span>
                <span class="n">file</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args</span><span class="p">([</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">file</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">parquet_file</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="c1"># Get the column names</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="n">parquet_file</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">names</span>
                <span class="k">return</span> <span class="n">column_names</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>       
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">from_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>    

        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Column_Names&#39;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">})</span>
            <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;column_names&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">column_names</span>

    <span class="k">def</span> <span class="nf">_table_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">product_overview</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieving Data Product overview from SFTP..wait a moment&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_overview</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">product_overview</span> <span class="o">=</span><span class="n">_table_names</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
            <span class="n">product_paths</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
            <span class="n">newest_exports</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">time_stamp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">repeating</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">data_products</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">product_path</span> <span class="ow">in</span> <span class="n">product_paths</span><span class="p">:</span>
                <span class="n">sel_product</span> <span class="o">=</span> <span class="n">product_overview</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">product_overview</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">product_path</span><span class="p">,</span> <span class="s1">&#39;Data Product&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel_product</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">data_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel_product</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">tnfs_folder</span> <span class="o">=</span> <span class="n">product_path</span> <span class="o">+</span> <span class="s1">&#39;/tnfs&#39;</span>
                <span class="n">export_paths</span> <span class="o">=</span>  <span class="n">sftp</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">product_path</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">sftp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tnfs_folder</span><span class="p">):</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">product_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">export_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">newest_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">time_stamp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">repeating</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;One-off&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Get all .tnfs files in the &#39;tnfs&#39; folder</span>
                <span class="n">tnfs_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tnfs_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tnf&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tnfs_files</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">tnfs_files</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>

                <span class="c1"># Initialize variables to keep track of the newest .tnfs file</span>
                <span class="n">newest_tnfs_file</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">newest_mtime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>

                <span class="c1"># Determine the newest .tnfs file</span>
                <span class="k">for</span> <span class="n">tnfs_file</span> <span class="ow">in</span> <span class="n">tnfs_files</span><span class="p">:</span>
                    <span class="n">tnfs_file_path</span>  <span class="o">=</span> <span class="n">tnfs_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">tnfs_file</span>
                    <span class="n">file_attributes</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">tnfs_file_path</span><span class="p">)</span>
                    <span class="n">mtime</span> <span class="o">=</span> <span class="n">file_attributes</span><span class="o">.</span><span class="n">st_mtime</span>
                    <span class="k">if</span> <span class="n">mtime</span> <span class="o">&gt;</span> <span class="n">newest_mtime</span><span class="p">:</span>
                        <span class="n">newest_mtime</span> <span class="o">=</span> <span class="n">mtime</span>
                        <span class="k">if</span> <span class="n">newest_tnfs_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newest_tnfs_file</span><span class="p">)</span>
                        <span class="n">newest_tnfs_file</span> <span class="o">=</span> <span class="n">tnfs_file_path</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tnfs_file_path</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">newest_tnfs_file</span><span class="p">:</span>

                    <span class="n">time_stamp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">newest_mtime</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">local_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>  <span class="s2">&quot;temp.tnf&quot;</span>
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">local_file</span> <span class="o">=</span> <span class="s2">&quot;temp.tnf&quot;</span>
                    <span class="n">sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">newest_tnfs_file</span><span class="p">,</span>  <span class="n">local_file</span><span class="p">)</span>

                    <span class="c1"># Read the contents of the newest .tnfs file</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">local_file</span> <span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">tnfs_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">newest_export</span> <span class="o">=</span> <span class="n">product_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">tnfs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DataFolder&#39;</span><span class="p">)</span>
                        <span class="n">newest_exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newest_export</span><span class="p">)</span>
                        <span class="n">repeating</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Repeating&#39;</span><span class="p">)</span>

                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_file</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">export_path</span> <span class="ow">in</span> <span class="n">export_paths</span><span class="p">:</span>
                        <span class="n">export_path</span> <span class="o">=</span> <span class="n">product_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>  <span class="n">export_path</span> 
                        <span class="k">if</span> <span class="n">export_path</span> <span class="o">!=</span> <span class="n">newest_export</span> <span class="ow">and</span> <span class="n">export_path</span> <span class="o">!=</span> <span class="n">tnfs_folder</span><span class="p">:</span>
                            <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">export_path</span><span class="p">)</span>

            <span class="c1"># Create a DataFrame from the lists</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span> <span class="n">data_products</span><span class="p">,</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">:</span> <span class="n">product_paths</span><span class="p">,</span><span class="s1">&#39;Newest Export&#39;</span><span class="p">:</span> <span class="n">newest_exports</span><span class="p">,</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="n">time_stamp</span><span class="p">,</span><span class="s1">&#39;Repeating&#39;</span><span class="p">:</span> <span class="n">repeating</span><span class="p">})</span>

            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">_</span> <span class="p">,</span> <span class="n">row</span>  <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>                
                <span class="n">data_product</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span>
                <span class="n">main_directory</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span>
                <span class="n">export</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Newest Export&#39;</span><span class="p">]</span>
                <span class="n">repeating</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Repeating&#39;</span><span class="p">]</span>
                <span class="n">tables</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">export</span><span class="p">)</span>

                <span class="n">full_paths</span>  <span class="o">=</span> <span class="p">[</span><span class="n">export</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">table</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>
                <span class="n">full_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">full_path</span> <span class="k">for</span> <span class="n">full_path</span> <span class="ow">in</span> <span class="n">full_paths</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data_product</span><span class="p">):</span>
                    <span class="n">data_product</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="n">_table_match</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

                <span class="c1"># Append a dictionary with export, timestamp, and modified_list to the list</span>
                <span class="k">for</span> <span class="n">full_path</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">full_paths</span><span class="p">,</span><span class="n">tables</span><span class="p">):</span>

                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span><span class="n">data_product</span><span class="p">,</span>
                                 <span class="c1">#&#39;Table&#39;: os.path.basename(full_path),</span>
                                 <span class="s1">&#39;Table&#39;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                                 <span class="s1">&#39;Base Directory&#39;</span><span class="p">:</span> <span class="n">full_path</span><span class="p">,</span>
                                 <span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                 <span class="s1">&#39;Repeating&#39;</span><span class="p">:</span><span class="n">repeating</span><span class="p">,</span>
                                 <span class="s1">&#39;Export&#39;</span><span class="p">:</span> <span class="n">export</span><span class="p">,</span>
                                 <span class="s1">&#39;Top-level Directory&#39;</span><span class="p">:</span><span class="n">main_directory</span><span class="p">})</span>

            <span class="c1"># Create a DataFrame from the list of dictionaries</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">return</span>  <span class="n">df</span><span class="p">,</span> <span class="n">to_delete</span>

    <span class="k">def</span> <span class="nf">_remove_exports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">to_delete</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">num_workers</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">to_delete</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_overview</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">batch_list</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">num_batches</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Splits the input list into a specified number of batches.&quot;&quot;&quot;</span>
            <span class="c1"># Calculate the batch size based on the total number of elements and the number of batches</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">num_batches</span><span class="p">:</span>
                <span class="n">num_batches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">)</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_batches</span>

            <span class="c1"># If there is a remainder, some batches will have one extra element</span>
            <span class="n">remainder</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_batches</span>

            <span class="n">batches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_batches</span><span class="p">):</span>
                <span class="c1"># Calculate the end index for each batch</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">remainder</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_list</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>

            <span class="k">return</span> <span class="n">batches</span>

        <span class="c1"># Detecting files to delete</span>
        <span class="n">lists</span> <span class="o">=</span> <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recursive_collect</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">to_delete</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">),</span><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Collecting files to delete&#39;</span><span class="p">)</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">lists</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="c1"># Define worker</span>
        <span class="k">if</span> <span class="n">num_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_workers</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span><span class="ow">and</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>

        <span class="c1"># Batch files to delete</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">batch_list</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span><span class="n">num_workers</span><span class="p">)</span>

        <span class="c1"># Deleting files</span>
        <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">batches</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">),</span><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Deleting files&#39;</span><span class="p">)</span>

        <span class="c1"># Deleting empty folders</span>
        <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_delete_folders</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">to_delete</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">),</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Deleting folders&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">folder_path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">recursive_delete</span><span class="p">(</span><span class="n">sftp</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">extensions</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span><span class="s2">&quot;.orc&quot;</span><span class="p">,</span><span class="s2">&quot;.avro&quot;</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">file_attr</span> <span class="ow">in</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir_attr</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file_attr</span><span class="o">.</span><span class="n">filename</span>

                <span class="c1"># Check if the file ends with any of the specified extensions</span>
                <span class="k">if</span> <span class="n">full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extensions</span><span class="p">):</span>
                    <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">sftp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                    <span class="n">recursive_delete</span><span class="p">(</span><span class="n">sftp</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">recursive_delete</span><span class="p">(</span><span class="n">sftp</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_recursive_collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">extensions</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.parquet&quot;</span><span class="p">,</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span><span class="s2">&quot;.orc&quot;</span><span class="p">,</span><span class="s2">&quot;.avro&quot;</span><span class="p">)):</span>
            <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file_attr</span> <span class="ow">in</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir_attr</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file_attr</span><span class="o">.</span><span class="n">filename</span>

                    <span class="c1"># Check if the file ends with any of the specified extensions</span>
                    <span class="k">if</span> <span class="n">full_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extensions</span><span class="p">):</span>
                        <span class="n">file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sftp</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                        <span class="n">subfolder_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recursive_collect</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span><span class="n">extensions</span><span class="p">)</span>
                        <span class="n">file_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subfolder_paths</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">file_paths</span>

    <span class="k">def</span> <span class="nf">_delete_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                   <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  

    <span class="k">def</span> <span class="nf">_delete_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">folder_path</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">recursive_delete</span><span class="p">(</span><span class="n">sftp</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">file_attr</span> <span class="ow">in</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir_attr</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">full_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file_attr</span><span class="o">.</span><span class="n">filename</span>
                <span class="n">sftp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>   

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">recursive_delete</span><span class="p">(</span><span class="n">sftp</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to delete folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_args</span><span class="p">):</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">inputs_args</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;time_stamp&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
                <span class="n">file_attributes</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_attributes</span><span class="o">.</span><span class="n">st_size</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_stamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">file_attributes</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_file_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">file_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;----------getting </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> file attributes&quot;</span><span class="p">)</span>

            <span class="c1"># Read multithreaded</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span><span class="ow">and</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> 
                <span class="n">params_list</span> <span class="o">=</span>  <span class="p">[(</span><span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
                <span class="n">dfs</span> <span class="o">=</span> <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attr</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">params_list</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span><span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Processing&#39;</span><span class="p">)</span>
                <span class="n">file_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------ Processing files in sequence&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">file_attributes</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">file_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_attr</span><span class="p">((</span><span class="n">file</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> path is not defined.&quot;</span><span class="p">)</span>

        <span class="n">file_attributes</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_attributes</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="o">+</span> <span class="s2">&quot;/file_attributes.csv&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_attributes</span>

    <span class="k">def</span> <span class="nf">_check_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;local&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
                        <span class="n">path</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;remote&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; created.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s2">&quot;remote&quot;</span><span class="p">:</span>
                <span class="n">sftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sftp</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span>
                        <span class="n">path</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remote path is invalid:&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Find the file that matches the match_string without the .csv suffix</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">files</span><span class="p">,</span><span class="n">path</span>

    <span class="k">def</span> <span class="nf">_check_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;file list must be a list of strings&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">file</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_file_exist</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span><span class="n">file</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file path is longer (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">) than the max path length of the OS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span><span class="si">}</span><span class="s2">. Set &#39;.local_path&#39; closer to root. The file is : &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span> 

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file path is longer (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">) than the max path length of the OS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span><span class="si">}</span><span class="s2">. Set &#39;.local_path&#39; closer to root. The file is : &#39;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>     

            <span class="k">return</span> <span class="n">file</span><span class="p">,</span> <span class="n">flag</span>

        <span class="n">local_file</span><span class="p">,</span><span class="n">flag</span> <span class="o">=</span> <span class="n">_file_exist</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> 

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span> 
                    <span class="n">remote_file</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">remote_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">sftp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">remote_file</span><span class="p">,</span> <span class="n">local_file</span><span class="p">)</span>
                    <span class="n">file_attributes</span> <span class="o">=</span> <span class="n">sftp</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">remote_file</span><span class="p">)</span>
                    <span class="n">time_stamp</span> <span class="o">=</span> <span class="n">file_attributes</span><span class="o">.</span><span class="n">st_mtime</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">local_file</span><span class="p">,</span> <span class="p">(</span><span class="n">time_stamp</span><span class="p">,</span> <span class="n">time_stamp</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading remote file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">local_file</span><span class="p">,</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">_curate_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flag</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span><span class="n">file</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">destination</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">local_file</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">select_cols</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">date_query</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">],</span> <span class="n">bvd_query</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query_args</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">select_cols</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="nb">all</span><span class="p">(</span><span class="n">date_query</span><span class="p">),</span><span class="n">bvd_query</span><span class="p">])</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">:</span> 

            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">]:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">_load_csv_table</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">local_file</span><span class="p">,</span> 
                                    <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span><span class="p">,</span> 
                                    <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span><span class="p">,</span> 
                                    <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span><span class="p">,</span> 
                                    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span> 
                                    <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">,</span>
                                    <span class="n">num_workers</span> <span class="o">=</span> <span class="n">num_workers</span>
                                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">_load_table</span><span class="p">(</span><span class="n">file</span> <span class="o">=</span> <span class="n">local_file</span><span class="p">,</span> 
                                    <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span><span class="p">,</span> 
                                    <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span><span class="p">,</span> 
                                    <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span><span class="p">,</span> 
                                    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span> 
                                    <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span>
                                    <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">destination</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">_save_files</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_file</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting local file: </span><span class="si">{</span><span class="n">local_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">local_file</span>  

        <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_name</span>

    <span class="k">def</span> <span class="nf">_process_sequential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">date_query</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">],</span> <span class="n">bvd_query</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query_args</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flags</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">total_files</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>   
            <span class="k">try</span><span class="p">:</span>
                <span class="n">local_file</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">df</span> <span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curate_file</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="p">,</span>
                                                    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">,</span>
                                                    <span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span><span class="p">,</span>
                                                    <span class="n">local_file</span> <span class="o">=</span> <span class="n">local_file</span><span class="p">,</span>
                                                    <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span><span class="p">,</span>
                                                    <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span><span class="p">,</span>
                                                    <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span><span class="p">,</span>
                                                    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span>
                                                    <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span><span class="p">,</span>
                                                    <span class="n">num_workers</span> <span class="o">=</span> <span class="n">num_workers</span>
                                                    <span class="p">)</span>
                <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dfs</span><span class="p">,</span><span class="n">file_names</span><span class="p">,</span><span class="n">flags</span>

    <span class="k">def</span> <span class="nf">_process_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs_args</span><span class="p">:</span><span class="nb">list</span><span class="p">):</span>      
        <span class="n">file</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">,</span> <span class="n">date_query</span><span class="p">,</span> <span class="n">bvd_query</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_args</span> <span class="o">=</span> <span class="n">inputs_args</span>
        <span class="n">local_file</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curate_file</span><span class="p">(</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="p">,</span>
                                                <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">,</span>
                                                <span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span><span class="p">,</span>
                                                <span class="n">local_file</span> <span class="o">=</span> <span class="n">local_file</span><span class="p">,</span>
                                                <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span><span class="p">,</span>
                                                <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span><span class="p">,</span>
                                                <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span><span class="p">,</span>
                                                <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span>
                                                <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span>
                                                <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">df</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span><span class="n">flag</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">destination</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">flag</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_detect_files</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">format_timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">formatted_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">formatted_timestamp</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;files&#39; is a empty list&quot;</span><span class="p">)</span> 
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;files&#39; should be str or list formats&quot;</span><span class="p">)</span> 

            <span class="n">existing_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span>
            <span class="n">missing_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No local or remote files detected&quot;</span><span class="p">)</span> 

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">local_path</span> <span class="o">=</span> <span class="s2">&quot;Data Products/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="o">+</span><span class="s1">&#39;_exported &#39;</span><span class="o">+</span> <span class="n">format_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">local_path</span> <span class="o">=</span> <span class="s2">&quot;Data Products/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="o">+</span><span class="s1">&#39;_one-off&#39;</span><span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

                <span class="n">missing_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="ow">and</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span><span class="p">]</span>
                <span class="n">existing_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="ow">or</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span><span class="p">]</span> 

            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_files</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Requested files cannot be found locally or remotely&#39;</span><span class="p">)</span> 

            <span class="k">return</span> <span class="n">existing_files</span><span class="p">,</span> <span class="n">missing_files</span>

        <span class="n">files</span><span class="p">,</span><span class="n">missing_files</span> <span class="o">=</span> <span class="n">_detect_files</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_files</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Missing files:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">missing_files</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">destination</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">:</span>    
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">timestamp_str</span> <span class="o">=</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">%H%M&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">suffix</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">suffix</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">)</span>

            <span class="n">destination</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp_str</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">base_path</span> <span class="o">=</span> <span class="n">base_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

            <span class="n">destination</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">destination</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">destination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">destination</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">parent_directory</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parent_directory</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parent_directory</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">files</span><span class="p">,</span> <span class="n">destination</span>   

    <span class="k">def</span> <span class="nf">_table_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_word</span><span class="p">):</span>

        <span class="n">filtered_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product`.str.contains(&#39;</span><span class="si">{</span><span class="n">search_word</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False) | `Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">search_word</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filtered_df</span>

    <span class="k">def</span> <span class="nf">_specify_data_products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">extract_options</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;Mutliple_Options: &quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="c1"># Extract the substring starting after &quot;Mutliple_Options: &quot;</span>
                <span class="n">list_str</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Mutliple_Options: &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Convert the extracted substring to a Python list using ast.literal_eval</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">options_list</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">list_str</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">options_list</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing list from row: </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Function to check if a row contains &quot;Mutliple_Options: &quot;  </span>
        <span class="k">def</span> <span class="nf">contains_multiple_options</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Mutliple_Options: &quot;</span> <span class="ow">in</span> <span class="n">row</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">df_multiple</span><span class="p">):</span>    
                    <span class="n">selected_values</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1"># Keep only columns &#39;1&#39; and &#39;2&#39;</span>
                    <span class="n">df_multiple</span> <span class="o">=</span> <span class="n">df_multiple</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]]</span>

                    <span class="c1"># Remove duplicate rows based on columns &#39;1&#39; and &#39;2&#39;</span>
                    <span class="n">df_multiple</span> <span class="o">=</span> <span class="n">df_multiple</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

                    <span class="c1"># Apply the function to the column &#39;1&#39; and store the results in a new column &#39;Options_List&#39;</span>
                    <span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Options_List&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_options</span><span class="p">)</span>

                    <span class="n">Select_obj</span> <span class="o">=</span> <span class="n">_Multi_dropdown</span><span class="p">(</span><span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Options_List&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="s2">&quot;Specify &#39;Data Product&#39; for unknown exports:&quot;</span><span class="p">)</span>

                    <span class="n">selected_values</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Select_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>


                    <span class="k">if</span> <span class="n">selected_values</span><span class="p">:</span>

                        <span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_values</span>

                        <span class="c1"># Create a mapping from df1</span>
                        <span class="n">mapping</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df_multiple</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

                        <span class="c1"># Update df2[&#39;2&#39;] based on the mapping</span>
                        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">])</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="n">df</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="o">=</span> <span class="n">df</span> 

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Filter rows where column &#39;1&#39; contains &quot;Mutliple_Options: &quot;</span>
        <span class="n">df_multiple</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">contains_multiple_options</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df_multiple</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">df_multiple</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="s1">&#39;s-f2112b8b980e44f9a.server.transfer.eu-west-1.amazonaws.com&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;D2vdz8elTWKyuOcC2kMSnw&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">privatekey</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Constructor Method</p>
<p>### Sftp Class Object Variables      <br />
- <code>connection</code>: None or pysftp.Connection object. Represents the current SFTP connection.</p>
<ul>
<li><code>hostname</code>: str. Hostname of the SFTP server (Default connects to CBS SFTP server).</li>
<li><code>username</code>: str. Username for authentication (Default connects to CBS SFTP server).</li>
<li><code>privatekey</code>: str or None. Path to the private key file for authentication (Valid private key is needed to access SFTP server)</li>
<li>
<p><code>port</code>: int. Port number for the SFTP connection (default is 22).</p>
</li>
<li>
<p><code>output_format</code>: list of str. List of supported output file formats (e.g., ['.csv', '.parquet']).</p>
</li>
<li><code>file_size_mb</code>: int. Maximum file size in MB for before splitting output files..</li>
<li><code>delete_files</code>: bool. Flag indicating whether to delete processed files.</li>
<li><code>concat_files</code>: bool. Flag indicating whether to concatenate processed files.</li>
<li><code>select_cols</code>: list or None. List of columns to select during file operations.</li>
<li><code>query</code>: str, fnc or None. Query string or function for filtering data.</li>
<li><code>query_args</code>: list or None. list of arguments for the query string or function.</li>
<li><code>dfs</code>: None or DataFrame. Stores concatenated DataFrames if concatenation is enabled.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;s-f2112b8b980e44f9a.server.transfer.eu-west-1.amazonaws.com&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;D2vdz8elTWKyuOcC2kMSnw&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span> <span class="n">privatekey</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor Method</span>

<span class="sd">     ### Sftp Class Object Variables        </span>
<span class="sd">    - `connection`: None or pysftp.Connection object. Represents the current SFTP connection.</span>

<span class="sd">    - `hostname`: str. Hostname of the SFTP server (Default connects to CBS SFTP server).</span>
<span class="sd">    - `username`: str. Username for authentication (Default connects to CBS SFTP server).</span>
<span class="sd">    - `privatekey`: str or None. Path to the private key file for authentication (Valid private key is needed to access SFTP server)</span>
<span class="sd">    - `port`: int. Port number for the SFTP connection (default is 22).</span>

<span class="sd">    - `output_format`: list of str. List of supported output file formats (e.g., [&#39;.csv&#39;, &#39;.parquet&#39;]).</span>
<span class="sd">    - `file_size_mb`: int. Maximum file size in MB for before splitting output files..</span>
<span class="sd">    - `delete_files`: bool. Flag indicating whether to delete processed files.</span>
<span class="sd">    - `concat_files`: bool. Flag indicating whether to concatenate processed files.</span>
<span class="sd">    - `select_cols`: list or None. List of columns to select during file operations.</span>
<span class="sd">    - `query`: str, fnc or None. Query string or function for filtering data.</span>
<span class="sd">    - `query_args`: list or None. list of arguments for the query string or function.</span>
<span class="sd">    - `dfs`: None or DataFrame. Stores concatenated DataFrames if concatenation is enabled.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set connection object to None (initial value)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">hostname</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">username</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">privatekey</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span> <span class="o">=</span> <span class="n">pysftp</span><span class="o">.</span><span class="n">CnOpts</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span><span class="o">.</span><span class="n">hostkeys</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;.csv&#39;</span><span class="p">]</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_local_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_local_files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_time_stamp</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s1">&#39;fork&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span> <span class="o">=</span> <span class="s1">&#39;fork&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pool_method</span> <span class="o">=</span> <span class="s1">&#39;threading&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_path_length</span> <span class="o">=</span> <span class="mi">256</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tables_available</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.connect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect</span><span class="p">()</span></code>

<a href="#moodys_datahub.tools.Sftp.connect" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Establish an SFTP connection.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.</p>
<p>Returns:
- SFTP connection object.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Establish an SFTP connection.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - SFTP connection object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sftp</span> <span class="o">=</span> <span class="n">pysftp</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="p">,</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="p">,</span><span class="n">private_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">,</span> <span class="n">cnopts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cnopts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sftp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.copy_obj" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_obj</span><span class="p">()</span></code>

<a href="#moodys_datahub.tools.Sftp.copy_obj" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Create a deep copy of the current Sftp instance with optional updates.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.</p>
<p>Returns:
- Deep copy of the current Sftp instance with optional updates.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">copy_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a deep copy of the current Sftp instance with optional updates.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Deep copy of the current Sftp instance with optional updates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">new_obj</span><span class="o">=</span> <span class="n">Sftp</span><span class="p">(</span><span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span> <span class="n">privatekey</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">privatekey</span><span class="p">)</span> 

    <span class="c1">#new_obj = copy.deepcopy(self)</span>

    <span class="n">new_obj</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>
    <span class="c1">#new_obj.bvd_list = None</span>
    <span class="c1">#new_obj.time_period = None</span>
    <span class="c1">#new_obj.select_cols = None</span>

    <span class="k">return</span> <span class="n">new_obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.get_column_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_column_names</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.get_column_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Retrieve column names from a DataFrame or dictionary and save them to a file.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.
- <code>save_to</code> (str, optional): Format to save results (default is CSV).
- <code>files</code> (list, optional): List of files to retrieve column names from.</p>
<p>Returns:
- List of column names or None if no valid source is provided.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve column names from a DataFrame or dictionary and save them to a file.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `save_to` (str, optional): Format to save results (default is CSV).</span>
<span class="sd">    - `files` (list, optional): List of files to retrieve column names from.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - List of column names or None if no valid source is provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">from_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">column_names</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No files were added&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span>   

        <span class="k">try</span><span class="p">:</span>
            <span class="n">file</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args</span><span class="p">([</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file</span><span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">parquet_file</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">ParquetFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="c1"># Get the column names</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">parquet_file</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">names</span>
            <span class="k">return</span> <span class="n">column_names</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>       
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">from_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>    

    <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Column_Names&#39;</span><span class="p">:</span> <span class="n">column_names</span><span class="p">})</span>
        <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;column_names&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">column_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.process_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_all</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">select_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">date_query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bvd_query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pool_method</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.process_all" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Read and process files into a DataFrame with optional filtering and parallel processing.</p>
<p>This method reads multiple files into Pandas DataFrames, optionally selecting specific columns and
applying filters, either sequentially or in parallel.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.
- <code>files</code> (list, optional): List of files to process. Defaults to <code>self.remote_files</code>.
- <code>destination</code> (str, optional): Destination path for processed files.
- <code>num_workers</code> (int, optional): Number of workers for parallel processing. Default is -1 (auto-determined).
- <code>select_cols</code> (list, optional): Columns to select from files. Default is <code>self._select_cols</code>.
- <code>date_query</code>: (optional): Date query for filtering data. Default is <code>self.time_period</code>.
- <code>bvd_query</code>: (optional): BVD query for filtering data. Default is <code>self._bvd_list[2]</code>.
- <code>query</code> (str, optional): Query for additional filtering of data.
- <code>query_args</code> (list, optional): Arguments for the query.</p>
<p>Returns:
- <code>dfs</code>: List of Pandas DataFrames with selected columns and filtered data.
- <code>file_names</code>: List of file names processed.</p>
<p>Notes:
- If <code>select_cols</code> is provided, it is validated against expected formats.
- Uses parallel processing if <code>num_workers</code> is greater than 1.
- Handles file concatenation and deletion based on instance attributes (<code>concat_files</code>, <code>delete_files</code>).
- Prints current working directory if <code>self.delete_files</code> is <code>True</code>.</p>
<p>Raises:
- <code>ValueError</code>: If validation of arguments (<code>files</code>, <code>destination</code>, <code>flag</code>) fails.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">destination</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">date_query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bvd_query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">query_args</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">pool_method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read and process files into a DataFrame with optional filtering and parallel processing.</span>

<span class="sd">    This method reads multiple files into Pandas DataFrames, optionally selecting specific columns and</span>
<span class="sd">    applying filters, either sequentially or in parallel.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `files` (list, optional): List of files to process. Defaults to `self.remote_files`.</span>
<span class="sd">    - `destination` (str, optional): Destination path for processed files.</span>
<span class="sd">    - `num_workers` (int, optional): Number of workers for parallel processing. Default is -1 (auto-determined).</span>
<span class="sd">    - `select_cols` (list, optional): Columns to select from files. Default is `self._select_cols`.</span>
<span class="sd">    - `date_query`: (optional): Date query for filtering data. Default is `self.time_period`.</span>
<span class="sd">    - `bvd_query`: (optional): BVD query for filtering data. Default is `self._bvd_list[2]`.</span>
<span class="sd">    - `query` (str, optional): Query for additional filtering of data.</span>
<span class="sd">    - `query_args` (list, optional): Arguments for the query.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - `dfs`: List of Pandas DataFrames with selected columns and filtered data.</span>
<span class="sd">    - `file_names`: List of file names processed.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - If `select_cols` is provided, it is validated against expected formats.</span>
<span class="sd">    - Uses parallel processing if `num_workers` is greater than 1.</span>
<span class="sd">    - Handles file concatenation and deletion based on instance attributes (`concat_files`, `delete_files`).</span>
<span class="sd">    - Prints current working directory if `self.delete_files` is `True`.</span>

<span class="sd">    Raises:</span>
<span class="sd">    - `ValueError`: If validation of arguments (`files`, `destination`, `flag`) fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">files</span> <span class="o">=</span> <span class="n">files</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span>
    <span class="n">date_query</span> <span class="o">=</span> <span class="n">date_query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span>
    <span class="n">bvd_query</span> <span class="o">=</span> <span class="n">bvd_query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span>
    <span class="n">query_args</span> <span class="o">=</span> <span class="n">query_args</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span>
    <span class="n">select_cols</span> <span class="o">=</span> <span class="n">select_cols</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span>

    <span class="c1"># To handle executing when download_all() have not finished!</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span> 
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">files_not_ready</span> <span class="o">=</span>  <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)</span> 
        <span class="k">while</span> <span class="n">files_not_ready</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">files_not_ready</span> <span class="o">=</span>  <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_files</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files have not finished downloading within the timeout period of </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span><span class="kc">True</span> 

    <span class="k">if</span> <span class="n">select_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="n">select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span>  <span class="nb">any</span><span class="p">([</span><span class="n">select_cols</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="nb">all</span><span class="p">(</span><span class="n">date_query</span><span class="p">),</span><span class="n">bvd_query</span><span class="p">])</span> 
        <span class="n">files</span><span class="p">,</span> <span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_args</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">destination</span><span class="p">,</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
        <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">num_workers</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="n">num_workers</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num_workers</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span><span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Read multithreaded</span>
    <span class="k">if</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">batch_processing</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">batch_list</span><span class="p">(</span><span class="n">input_list</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Splits the input list into batches of a given size.&quot;&quot;&quot;</span>
                <span class="n">batches</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
                    <span class="n">batches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_list</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">batches</span>

            <span class="n">batches</span> <span class="o">=</span> <span class="n">batch_list</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="n">num_workers</span><span class="p">)</span>

            <span class="n">lists</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in Parallel&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batches</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing Batch </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------ First file: &#39;</span><span class="si">{</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>  
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;------ Last file : &#39;</span><span class="si">{</span><span class="n">batch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>               
                <span class="n">params_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">file</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">,</span> <span class="n">date_query</span><span class="p">,</span> <span class="n">bvd_query</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_args</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
                <span class="n">list_batch</span> <span class="o">=</span> <span class="n">_run_parallel</span><span class="p">(</span><span class="n">fnc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_parallel</span><span class="p">,</span><span class="n">params_list</span><span class="o">=</span><span class="n">params_list</span><span class="p">,</span><span class="n">n_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span><span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span><span class="n">pool_method</span><span class="o">=</span><span class="n">pool_method</span> <span class="p">,</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Processing&#39;</span><span class="p">)</span>
                <span class="n">lists</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">list_batch</span><span class="p">)</span>


            <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>
            <span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_names</span> <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

            <span class="n">dfs</span> <span class="o">=</span>  <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span> <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

            <span class="n">flags</span> <span class="o">=</span>  <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span>

        <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">batch_processing</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span> <span class="c1"># Read Sequential</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files in sequence&#39;</span><span class="p">)</span>
        <span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_sequential</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">select_cols</span><span class="p">,</span> <span class="n">date_query</span><span class="p">,</span> <span class="n">bvd_query</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">query_args</span><span class="p">,</span><span class="n">num_workers</span><span class="p">)</span>

    <span class="n">flag</span> <span class="o">=</span>  <span class="nb">all</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> 

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>

        <span class="c1"># Concatenate and save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span> <span class="o">=</span> <span class="n">_save_chunks</span><span class="p">(</span><span class="n">dfs</span><span class="o">=</span><span class="n">dfs</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span><span class="n">output_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">,</span><span class="n">file_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_size_mb</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">,</span> <span class="n">file_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.process_one" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_one</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.process_one" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Retrieve a sample of data from a table and save it to a file.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.
- <code>files</code> (list, optional): List of files to process. Defaults to <code>self.remote_files</code>.
- <code>save_to</code> (str, optional): Format to save sample data (default is CSV).
- <code>n_rows</code> (int, optional): Number of rows to retrieve (default is 1000).</p>
<p>Returns:
- Pandas Dateframe with output</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">process_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">files</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">n_rows</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a sample of data from a table and save it to a file.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `files` (list, optional): List of files to process. Defaults to `self.remote_files`.</span>
<span class="sd">    - `save_to` (str, optional): Format to save sample data (default is CSV).</span>
<span class="sd">    - `n_rows` (int, optional): Number of rows to retrieve (default is 1000).</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Pandas Dateframe with output</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>    

    <span class="n">df</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_all</span><span class="p">(</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">,</span><span class="n">num_workers</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">df</span>  <span class="o">=</span> <span class="n">_load_table</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
        <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;process_one&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n_rows</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results have been saved to &#39;</span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No rows were retained&quot;</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.search_country_codes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_country_codes</span><span class="p">(</span><span class="n">search_word</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Country&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Code&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></code>

<a href="#moodys_datahub.tools.Sftp.search_country_codes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Search for country codes matching a search term.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.
- <code>search_word</code> (str, optional): Term to search for country codes.
- <code>search_cols</code> (dict, optional): Dictionary indicating columns to search (default is {'Country':True,'Code':True}).</p>
<p>Returns:
- Pandas Dataframe of country codes matching the search term</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">search_country_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">search_word</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Country&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Code&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}):</span>        
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for country codes matching a search term.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `search_word` (str, optional): Term to search for country codes.</span>
<span class="sd">    - `search_cols` (dict, optional): Dictionary indicating columns to search (default is {&#39;Country&#39;:True,&#39;Code&#39;:True}).</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Pandas Dataframe of country codes matching the search term</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">_country_codes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">`.str.contains(&#39;{{search_word}}&#39;, case=False, na=False,regex=False)&quot;</span>
        <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
        <span class="n">final_string</span> <span class="o">=</span> <span class="n">search_conditions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_word</span><span class="o">=</span><span class="n">search_word</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">final_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
            <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such &#39;search word&#39; was detected across columns: &quot;</span> <span class="o">+</span> <span class="n">search_conditions</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folloiwng query was executed:&quot;</span> <span class="o">+</span> <span class="n">final_string</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.search_dictionary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_dictionary</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">search_word</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Table&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Column&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Definition&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">letters_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extact_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.search_dictionary" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Search for a term in a column/variable dictionary and save results to a file.</p>
<p>Args:
- <code>self</code>: Implicit reference to the instance.
- <code>save_to</code> (str, optional): Format to save results. If False, results are not saved (default is False).
- <code>search_word</code> (str, optional): Search term. If None, no term is searched.
- <code>search_cols</code> (dict, optional): Dictionary indicating which columns to search. Columns are 'Data Product', 'Table', 'Column', and 'Definition' with default value as True for each.
- <code>letters_only</code> (bool, optional): If True, search only for alphabetic characters in the search term (default is False).
- <code>exact_match</code> (bool, optional): If True, search for an exact match of the search term. Otherwise, search for partial matches (default is False).
- <code>data_product</code> (str, optional): Specific data product to filter results by. If None, no filtering by data product (default is None).
- <code>table</code> (str, optional): Specific table to filter results by. If None, no filtering by table (default is None).</p>
<p>Returns:
- pandas.DataFrame: A DataFrame containing the search results. If no results are found, an empty DataFrame is returned.</p>
<p>Notes:
- If <code>data_product</code> is provided and does not match any records, a message is printed and an empty DataFrame is returned.
- If <code>table</code> is provided and does not match any records, it attempts to perform a case-insensitive partial match search.
- If <code>search_word</code> is provided and no matches are found, a message is printed indicating no results were found.
- If <code>letters_only</code> is True, the search term is processed to include only alphabetic characters before searching.
- If <code>save_to</code> is specified, the query results are saved in the format specified.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">search_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">search_word</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">search_cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Data Product&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Column&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;Definition&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span> <span class="n">letters_only</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">extact_match</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for a term in a column/variable dictionary and save results to a file.</span>

<span class="sd">    Args:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `save_to` (str, optional): Format to save results. If False, results are not saved (default is False).</span>
<span class="sd">    - `search_word` (str, optional): Search term. If None, no term is searched.</span>
<span class="sd">    - `search_cols` (dict, optional): Dictionary indicating which columns to search. Columns are &#39;Data Product&#39;, &#39;Table&#39;, &#39;Column&#39;, and &#39;Definition&#39; with default value as True for each.</span>
<span class="sd">    - `letters_only` (bool, optional): If True, search only for alphabetic characters in the search term (default is False).</span>
<span class="sd">    - `exact_match` (bool, optional): If True, search for an exact match of the search term. Otherwise, search for partial matches (default is False).</span>
<span class="sd">    - `data_product` (str, optional): Specific data product to filter results by. If None, no filtering by data product (default is None).</span>
<span class="sd">    - `table` (str, optional): Specific table to filter results by. If None, no filtering by table (default is None).</span>

<span class="sd">    Returns:</span>
<span class="sd">    - pandas.DataFrame: A DataFrame containing the search results. If no results are found, an empty DataFrame is returned.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - If `data_product` is provided and does not match any records, a message is printed and an empty DataFrame is returned.</span>
<span class="sd">    - If `table` is provided and does not match any records, it attempts to perform a case-insensitive partial match search.</span>
<span class="sd">    - If `search_word` is provided and no matches are found, a message is printed indicating no results were found.</span>
<span class="sd">    - If `letters_only` is True, the search term is processed to include only alphabetic characters before searching.</span>
<span class="sd">    - If `save_to` is specified, the query results are saved in the format specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span> <span class="o">=</span> <span class="n">_table_dictionary</span><span class="p">()</span>        
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dictionary</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())]</span>

    <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_product</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_product</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df_product</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_product</span>
        <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>   
            <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df_table</span>
        <span class="n">search_cols</span><span class="p">[</span><span class="s1">&#39;Table&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df_table</span> 

    <span class="k">if</span> <span class="n">search_word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
            <span class="n">df_backup</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">search_word</span> <span class="o">=</span> <span class="n">_letters_only_regex</span><span class="p">(</span><span class="n">search_word</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_letters_only_regex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extact_match</span><span class="p">:</span>
            <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">` ==  &#39;{{search_word}}&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">{col}</span><span class="s2">`.str.contains(&#39;{{search_word}}&#39;, case=False, na=False,regex=False)&quot;</span>

        <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
        <span class="n">final_string</span> <span class="o">=</span> <span class="n">search_conditions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_word</span><span class="o">=</span><span class="n">search_word</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">final_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">base_string</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">{col}</span><span class="s2">&#39;&quot;</span>
            <span class="n">search_conditions</span> <span class="o">=</span> <span class="s2">&quot; , &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">search_cols</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">include</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such &#39;search word&#39; was detected across columns: &quot;</span> <span class="o">+</span> <span class="n">search_conditions</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>

        <span class="k">if</span> <span class="n">letters_only</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_backup</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">save_to</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The folloiwng query was executed:&quot;</span> <span class="o">+</span> <span class="n">final_string</span><span class="p">)</span>

    <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;dict_search&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.select_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_columns</span><span class="p">()</span></code>

<a href="#moodys_datahub.tools.Sftp.select_columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Asynchronously select and set columns for a specified data product and table using interactive widgets.</p>
<p>This method performs the following steps:
1. Checks if the data product and table are set. If not, it calls <code>select_data()</code> to set them.
2. Searches the dictionary for columns corresponding to the set data product and table.
3. Displays an interactive widget for the user to select columns based on their names and definitions.
4. Sets the selected columns to <code>self._select_cols</code> and prints the selected columns.</p>
<p>If no columns are found for the specified table, a <code>ValueError</code> is raised.</p>
<p>Args:
- <code>self</code>: Implicit reference to the instance.</p>
<p>Notes:
- This method uses <code>asyncio.ensure_future</code> to run the asynchronous function <code>f</code> which handles the widget interaction.
- The function <code>f</code> combines column names and definitions for display, maps selected items to their indices,
and then extracts the selected columns based on these indices.</p>
<p>Raises:
- <code>ValueError</code>: If no columns are found for the specified table.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>self.select_columns()</p>
</details>
            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asynchronously select and set columns for a specified data product and table using interactive widgets.</span>

<span class="sd">    This method performs the following steps:</span>
<span class="sd">    1. Checks if the data product and table are set. If not, it calls `select_data()` to set them.</span>
<span class="sd">    2. Searches the dictionary for columns corresponding to the set data product and table.</span>
<span class="sd">    3. Displays an interactive widget for the user to select columns based on their names and definitions.</span>
<span class="sd">    4. Sets the selected columns to `self._select_cols` and prints the selected columns.</span>

<span class="sd">    If no columns are found for the specified table, a `ValueError` is raised.</span>

<span class="sd">    Args:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - This method uses `asyncio.ensure_future` to run the asynchronous function `f` which handles the widget interaction.</span>
<span class="sd">    - The function `f` combines column names and definitions for display, maps selected items to their indices,</span>
<span class="sd">    and then extracts the selected columns based on these indices.</span>

<span class="sd">    Raises:</span>
<span class="sd">    - `ValueError`: If no columns are found for the specified table.</span>

<span class="sd">    Example:</span>
<span class="sd">        self.select_columns()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">):</span>

        <span class="n">combined</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">  -----  </span><span class="si">{</span><span class="n">defn</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">defn</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">)]</span>

        <span class="n">Select_obj</span> <span class="o">=</span> <span class="n">_SelectMultiple</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span><span class="s1">&#39;Columns:&#39;</span><span class="p">,</span><span class="s2">&quot;Select Table Columns&quot;</span><span class="p">)</span>
        <span class="n">selected_list</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Select_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selected_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Create a dictionary to map selected strings to their indices in the combined list</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="n">combined</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">}</span>

            <span class="c1"># Extract selected columns based on indices</span>
            <span class="n">selected_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">selected_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="n">_check_list_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_bvd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_period</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following columns have been selected: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_data</span><span class="p">()</span>

    <span class="n">table_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_dictionary</span><span class="p">(</span><span class="n">data_product</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">,</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">table_cols</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_select_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No columns were found for this table&quot;</span><span class="p">)</span>

    <span class="n">column</span> <span class="o">=</span> <span class="n">table_cols</span><span class="p">[</span><span class="s1">&#39;Column&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">table_cols</span><span class="p">[</span><span class="s1">&#39;Definition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">definition</span><span class="p">))</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.select_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_data</span><span class="p">()</span></code>

<a href="#moodys_datahub.tools.Sftp.select_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Asynchronously select and set the data product and table using interactive widgets.</p>
<p>This method initializes an instance of <code>_SelectData</code> with <code>_tables_backup</code>, displays interactive widgets
to allow the user to select a data product and table, and sets these selections to <code>self.set_data_product</code>
and <code>self.set_table</code>, respectively. It also prints the selected data product and table.</p>
<p>The method ensures that <code>_tables_available</code> or <code>_tables_backup</code> is populated by calling <code>tables_available()</code>
if they are not already set.</p>
<p>Notes:
- This method uses <code>asyncio.ensure_future</code> to run the asynchronous function <code>f</code> which handles the widget interaction.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>self.select_data()</p>
</details>
            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asynchronously select and set the data product and table using interactive widgets.</span>

<span class="sd">    This method initializes an instance of `_SelectData` with `_tables_backup`, displays interactive widgets</span>
<span class="sd">    to allow the user to select a data product and table, and sets these selections to `self.set_data_product`</span>
<span class="sd">    and `self.set_table`, respectively. It also prints the selected data product and table.</span>

<span class="sd">    The method ensures that `_tables_available` or `_tables_backup` is populated by calling `tables_available()`</span>
<span class="sd">    if they are not already set.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - This method uses `asyncio.ensure_future` to run the asynchronous function `f` which handles the widget interaction.</span>

<span class="sd">    Example:</span>
<span class="sd">        self.select_data()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Select_obj</span> <span class="o">=</span> <span class="n">_SelectData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">,</span><span class="s1">&#39;Select Data Product and Table&#39;</span><span class="p">)</span>
        <span class="n">selected_product</span><span class="p">,</span> <span class="n">selected_table</span> <span class="o">=</span> <span class="k">await</span> <span class="n">Select_obj</span><span class="o">.</span><span class="n">display_widgets</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">,</span><span class="s1">&#39;Base Directory&#39;</span><span class="p">,</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">selected_product</span><span class="si">}</span><span class="s2">&#39; &amp; `Table` == &#39;</span><span class="si">{</span><span class="n">selected_table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Top-level Directory&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Multiple data products match &#39;</span><span class="si">{</span><span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;. Please set right data product:&quot;</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span> <span class="o">=</span> <span class="n">selected_table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_data_product</span> <span class="o">=</span> <span class="n">selected_product</span>
            <span class="n">_select_list</span><span class="p">(</span><span class="s1">&#39;_SelectList&#39;</span><span class="p">,</span><span class="n">options</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">product</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="n">_select_product</span><span class="p">,[</span><span class="n">df</span><span class="p">,</span><span class="bp">self</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="o">=</span> <span class="n">selected_product</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="o">=</span> <span class="n">selected_table</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span><span class="si">}</span><span class="s2"> was set as Data Product&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">set_table</span><span class="si">}</span><span class="s2"> was set as Table&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_download_finished</span> <span class="o">=</span> <span class="kc">None</span> 

    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.table_dates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">table_dates</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.table_dates" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Retrieve and save the available date columns for a specified data product and table.</p>
<p>This method performs the following steps:
1. Ensures that the available tables and table dates are loaded.
2. Filters the dates data by the specified data product and table, if provided.
3. Optionally saves the filtered results to a specified format.</p>
<p>Args:
- <code>self</code>: Implicit reference to the instance.
- <code>save_to</code> (str, optional): Format to save results. If False, results are not saved (default is False).
- <code>data_product</code> (str, optional): Specific data product to filter results by. If None, defaults to <code>self.set_data_product</code>.
- <code>table</code> (str, optional): Specific table to filter results by. If None, defaults to <code>self.set_table</code>.</p>
<p>Returns:
- pandas.DataFrame: A DataFrame containing the filtered dates for the specified data product and table. If no results are found, an empty DataFrame is returned.</p>
<p>Notes:
- If <code>data_product</code> is provided and does not match any records, a message is printed and an empty DataFrame is returned.
- If <code>table</code> is provided and does not match any records, it attempts to perform a case-insensitive partial match search.
- If <code>save_to</code> is specified, the query results are saved in the format specified.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>df = self.table_dates(save_to='csv', data_product='Product1', table='TableA')</p>
</details>
            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">table_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_product</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve and save the available date columns for a specified data product and table.</span>

<span class="sd">    This method performs the following steps:</span>
<span class="sd">    1. Ensures that the available tables and table dates are loaded.</span>
<span class="sd">    2. Filters the dates data by the specified data product and table, if provided.</span>
<span class="sd">    3. Optionally saves the filtered results to a specified format.</span>

<span class="sd">    Args:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `save_to` (str, optional): Format to save results. If False, results are not saved (default is False).</span>
<span class="sd">    - `data_product` (str, optional): Specific data product to filter results by. If None, defaults to `self.set_data_product`.</span>
<span class="sd">    - `table` (str, optional): Specific table to filter results by. If None, defaults to `self.set_table`.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - pandas.DataFrame: A DataFrame containing the filtered dates for the specified data product and table. If no results are found, an empty DataFrame is returned.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - If `data_product` is provided and does not match any records, a message is printed and an empty DataFrame is returned.</span>
<span class="sd">    - If `table` is provided and does not match any records, it attempts to perform a case-insensitive partial match search.</span>
<span class="sd">    - If `save_to` is specified, the query results are saved in the format specified.</span>

<span class="sd">    Example:</span>
<span class="sd">        df = self.table_dates(save_to=&#39;csv&#39;, data_product=&#39;Product1&#39;, table=&#39;TableA&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_data_product</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_table</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span> <span class="o">=</span> <span class="n">_table_dates</span><span class="p">()</span>        
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_dates</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="p">[</span><span class="s1">&#39;Data Product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())]</span>

    <span class="k">if</span> <span class="n">data_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_product</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Data Product` == &#39;</span><span class="si">{</span><span class="n">data_product</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_product</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Data Product was found. Please set right data product&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df_product</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df_product</span>
    <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table` == &#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">df_table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`Table`.str.contains(&#39;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&#39;, case=False, na=False,regex=False)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">df_table</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No such Table was found. Please set right table&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df_table</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df_table</span>

    <span class="n">_save_to</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;date_cols_search&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>    
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="moodys_datahub.tools.Sftp.tables_available" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tables_available</span><span class="p">(</span><span class="n">save_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#moodys_datahub.tools.Sftp.tables_available" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Retrieve available SFTP data products and tables and save them to a file.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.
- <code>save_to</code> (str, optional): Format to save results (default is CSV).
- <code>reset</code> (bool, optional): Reset flag to force refreshing data products and tables.</p>
<p>Returns:
- Pandas DataFrame with the available SFTP data products and tables.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tables_available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_to</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">reset</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve available SFTP data products and tables and save them to a file.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>
<span class="sd">    - `save_to` (str, optional): Format to save results (default is CSV).</span>
<span class="sd">    - `reset` (bool, optional): Reset flag to force refreshing data products and tables.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Pandas DataFrame with the available SFTP data products and tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="p">,</span><span class="n">to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_overview</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">==</span> <span class="s2">&quot;s-f2112b8b980e44f9a.server.transfer.eu-west-1.amazonaws.com&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------  DELETING OLD EXPORTS FROM SFTP&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_exports</span><span class="p">(</span><span class="n">to_delete</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">reset</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_backup</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Specify unknown data product exports</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_specify_data_products</span><span class="p">()</span>

    <span class="n">_save_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="p">,</span><span class="s1">&#39;tables_available&#39;</span><span class="p">,</span><span class="n">save_to</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tables_available</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="moodys_datahub.utils"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="moodys_datahub.utils.fuzzy_match" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fuzzy_match</span><span class="p">(</span><span class="n">input_strings</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">match_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cut_off</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">remove_str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.utils.fuzzy_match" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Perform fuzzy string matching with a list of input strings against a specific column in a DataFrame.</p>
<p>Parameters:
- input_strings (list): A list of strings for fuzzy matching.
- df (pandas.DataFrame): The DataFrame containing the target columns.
- match_column (str): The name of the column to match against.
- return_column (str): The name of the column from which to return the matching value.
- remove_str (list): A list of substrings to remove from the choices.</p>
<p>Returns:
- pandas.DataFrame: A DataFrame containing the original data along with the best match, its score, and the matching value from another column.</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fuzzy_match</span><span class="p">(</span><span class="n">input_strings</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">num_workers</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">match_column</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">return_column</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cut_off</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span> <span class="p">,</span> <span class="n">remove_str</span><span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform fuzzy string matching with a list of input strings against a specific column in a DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - input_strings (list): A list of strings for fuzzy matching.</span>
<span class="sd">    - df (pandas.DataFrame): The DataFrame containing the target columns.</span>
<span class="sd">    - match_column (str): The name of the column to match against.</span>
<span class="sd">    - return_column (str): The name of the column from which to return the matching value.</span>
<span class="sd">    - remove_str (list): A list of substrings to remove from the choices.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - pandas.DataFrame: A DataFrame containing the original data along with the best match, its score, and the matching value from another column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">remove_substrings</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">substrings</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">substring</span> <span class="ow">in</span> <span class="n">substrings</span><span class="p">:</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">choice</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">substring</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">choices</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">choice</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">match_column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="n">input_strings</span> <span class="o">=</span> <span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">input_strings</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">remove_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="n">remove_substrings</span><span class="p">(</span><span class="n">choices</span><span class="p">,</span> <span class="n">remove_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_workers</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">))</span><span class="ow">and</span> <span class="n">num_workers</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">num_workers</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">args_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">input_string</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">match_column</span><span class="p">,</span> <span class="n">return_column</span><span class="p">)</span> <span class="k">for</span> <span class="n">input_string</span> <span class="ow">in</span> <span class="n">input_strings</span><span class="p">]</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_fuzzy_worker</span><span class="p">,</span> <span class="n">args_list</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="k">for</span> <span class="n">input_string</span> <span class="ow">in</span> <span class="n">input_strings</span><span class="p">:</span>
            <span class="n">args_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">cut_off</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">match_column</span><span class="p">,</span> <span class="n">return_column</span><span class="p">)</span>
            <span class="n">input_string</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">match_value</span><span class="p">,</span> <span class="n">return_value</span> <span class="o">=</span> <span class="n">_fuzzy_worker</span><span class="p">(</span><span class="n">args_list</span><span class="p">)</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">input_string</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">match_value</span><span class="p">,</span> <span class="n">return_value</span><span class="p">))</span>

    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Search_string&#39;</span><span class="p">,</span> <span class="s1">&#39;BestMatch&#39;</span><span class="p">,</span> <span class="s1">&#39;Score&#39;</span><span class="p">,</span> <span class="n">match_column</span><span class="p">,</span> <span class="n">return_column</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result_df</span>


    <span class="k">def</span> <span class="nf">replace_columns_with_na</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">replacement_value</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;N/A&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">df</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replacement_value</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">output_format</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;.xlsx&#39;</span><span class="p">:</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.xlsx&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">current_file</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;.parquet&#39;</span><span class="p">:</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.parquet&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;.pickle&#39;</span><span class="p">:</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span> 
            <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;.dta&#39;</span><span class="p">:</span>
                <span class="n">current_file</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.dta&#39;</span>              
                <span class="n">df</span> <span class="o">=</span> <span class="n">replace_columns_with_na</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">replacement_value</span><span class="o">=</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span> <span class="c1"># .dta format does not like empty columns so these are removed</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>
            <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PermissionError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Check if you have the necessary permissions to write to the specified location.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_copy&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving &quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&quot; as &quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">_copy&quot; instead&#39;</span><span class="p">)</span>
            <span class="n">current_file</span> <span class="o">=</span> <span class="n">_save_files</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;_copy&quot;</span><span class="p">,</span><span class="n">output_format</span><span class="p">)</span>
            <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&quot; was not saved&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">file_names</span>




<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the title to lowercase and removes non-alphanumeric characters.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="moodys_datahub.utils.year_distribution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">year_distribution</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#moodys_datahub.utils.year_distribution" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

      <p>Display the distribution of years in the data.</p>
<p>Input Variables:
- <code>self</code>: Implicit reference to the instance.</p>
<p>Returns:
- None</p>

            <details class="quote">
              <summary>Source code in <code>moodys_datahub\utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">year_distribution</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the distribution of years in the data.</span>

<span class="sd">    Input Variables:</span>
<span class="sd">    - `self`: Implicit reference to the instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No Dataframe (df) was detected&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">columns_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;closing_date&#39;</span><span class="p">,</span> <span class="s1">&#39;information_date&#39;</span><span class="p">]</span>
    <span class="n">date_col</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_to_check</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">date_col</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No valid date columns found&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Convert the date column to datetime</span>
    <span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">)</span>

    <span class="c1"># Create a new column extracting the year</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">date_col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

    <span class="n">year_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">year_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>

    <span class="c1"># Sort by year</span>
    <span class="n">year_counts</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>

    <span class="c1"># Calculate percentage</span>
    <span class="n">year_counts</span><span class="p">[</span><span class="s1">&#39;Percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_counts</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">year_counts</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Calculate total row</span>
    <span class="n">total_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">],</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">year_counts</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()],</span><span class="s1">&#39;Percentage&#39;</span><span class="p">:[</span><span class="n">year_counts</span><span class="p">[</span><span class="s1">&#39;Percentage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()]})</span>

    <span class="c1"># Concatenate total row to the DataFrame</span>
    <span class="n">year_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">year_counts</span><span class="p">,</span> <span class="n">total_row</span><span class="p">])</span>

    <span class="c1"># Display the table</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "toc.follow", "search.suggest", "search.higlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>